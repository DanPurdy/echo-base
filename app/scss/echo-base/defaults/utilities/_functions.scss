//==============================================================================
//
//  echo-base/defaults/utilities/_functions.scss
//
//  ----------------------------------------------------------------------------
//  Table of contents
//  ----------------------------------------------------------------------------
//  a. Breakpoints
//      1. Setup breakpoints
//      2. Get breakpoint
//  b. Palette
//      1. Setup palettes
//      2. Get palette
//  c. Typography
//      1. Merge responsive text element maps
//      2. Merge responsive text custom map with default map
//      3. Get responsive text element properties
//      4. Get breakpoint for responsive text element
//  d. Helpers
//      1. Strip Unit
//      2. Remify
//      3. Rem Calc
//
//
//  @copyright 2015, Loft Digital, www.weareloft.com
//
//==============================================================================




//==============================================================================
//  a. Breakpoints
//==============================================================================

//  1. Setup breakpoints
//==============================================================================

$breakpoints: ();

/// This function will check to see if custom breakpoints have been specified
/// within the $custom-breakpoints map within the _settings.scss file.
///
/// If custom breakpoints have been specified it will return a new map which
/// comprises the contents of $default-breakpoints and $custom-breakpoints.
///
/// If no custom breakpoints are specified only the default breakpoints will be
/// returned.
///
/// @access private
/// @return {Map}

@function setup-breakpoints() {
    @if (length($custom-breakpoints) > 0) {
        @return map-merge($default-breakpoints, $custom-breakpoints);
    } @else {
        @return $default-breakpoints;
    }
}



//  2. Get breakpoint
//==============================================================================

/// The break function is used within the Breakpoint mixin.
///
/// It is used to pull the specified key from the breakpoints map, first it sets
/// the map returned from our setup-breakpoints function and assigns it to a
/// $breakpoints variable.
///
/// Using the sass function map-has-key it then looks to see if the key passed
/// to the function exists in the map. If the key does exist it returns that
/// key's value else it returns a sass warning.
///
/// @access private
/// @param {String} $key - Breakpoint map key
/// @return {Map}

@function breakpoint($key) {

    @if length($breakpoints) == 0 {
        $breakpoints: setup-breakpoints();
    }

    @if (map-has-key($breakpoints, $key)) {
        @return map-get($breakpoints, $key);
    } @else {
        @warn "Breakpoint '#{$key}' doesn't exist!";
        @return false;
    }
}



//  3. Order Breakpoints by size
//==============================================================================

@function order-breakpoints() {
    $breakpoint-map: setup-breakpoints();
    $map-list: ();

    @for $i from 1 through length($breakpoint-map) {
        $current-highest: 0;
        $current-value: '';

        @each $key, $value in $breakpoint-map {
            @if index($map-list, $key) == null {
                $value: strip-unit($value);

                @if($value > $current-highest) {
                    $current-highest: $value;
                    $current-value: $key;
                }
            }
        }

        $map-list: append($map-list, $current-value);
    }

    @return $map-list;
}




//==============================================================================
//  b. Palettes
//==============================================================================

//  1. Setup palettes
//==============================================================================

/// This function will check to see if custom palettes have been specified
/// within the $custom-palettes map within the _settings.scss file.
///
/// If custom palettes have been specified then this function will return a new
/// map which comprises the contents of $default-palettes and $custom-palettes.
///
/// If no custom palettes are specified only the default palette map will be
/// returned.
///
/// @access private
/// @return {Map}

@function setup-palettes() {

    $palettes: ();

    // Include if custom palettes are in use
    @if (length($custom-palettes) > 0) {
        $palettes: map-merge($default-palettes, $custom-palettes);
    } @else {
        $palettes: $default-palettes;
    }

    // Include third-party palette if enabled
    @if ($use-third-party-palette) {
        $palettes: map-merge($palettes, $third-party-palettes);
    }

    @return $palettes;
}



//  2. Get palette
//==============================================================================

/// Retrieves the palette and the specified tone from the global palettes map
///
/// @access public
/// @param {String} $palette - Palette name
/// @param {String} $tone ['base'] - Palette tone
/// @return {Map}

@function palette($palette, $tone: 'base') {

    $palettes: setup-palettes();

    @if (map-has-key($palettes, $palette)) {

        $color: map-get($palettes, $palette);

        @if (map-has-key($color, $tone)) {
            @return map-get($color, $tone);
        } @else {
            @warn "Tone '#{$tone}' doesn't exist for palette '#{$color}'!";
        }
    } @else {
        @warn "Palette '#{$palette}' doesn't exist!";
    }
}




//==============================================================================
//  c. Typography
//==============================================================================

//  1. Merge responsive text element maps
//==============================================================================

$responsive-text-map: ();

@function setup-responsive-text($element) {

    @if length($responsive-text-custom) > 0 {

        @if map-has-key($responsive-text-map, $element) {

            @return $responsive-text-map;

        } @else {

            $repsonsive-text-map: merge-responsive-maps();

            @return $repsonsive-text-map;
        }

    } @else {

        @return $responsive-text-defaults;
    }
}



//  2. Merge responsive text custom map with default map
//==============================================================================

@function merge-responsive-maps() {

    @each $key, $value in $responsive-text-defaults {

        @if map-has-key($responsive-text-custom, $key) {

            //assign the defaults map value of the same name to a new map with the key test
            // if we were to merge two maps with the same key they would overwrite, this way we can be sure that the map will merge
            $existing-map: (test: map-get($responsive-text-defaults, $key));
            $new-map: ($key: map-merge(map-get($existing-map, test), map-get($responsive-text-custom, $key)));
            $responsive-text-map: map-merge($responsive-text-map, $new-map);

        } @else {

            $new-map: ($key: $value);
            $responsive-text-map: map-merge($responsive-text-map, $new-map);
        }
    }

    @return $responsive-text-map;
}



//  3. Get responsive text element properties
//==============================================================================

// http://maketea.co.uk/2014/11/05/managing-responsive-typography-with-sass.html

@function text-breakpoints-for($element) {

    $responsive-text: setup-responsive-text($element);

    @if map-has-key($responsive-text, $element) {
        @return map-get($responsive-text, $element);
    } @else {
        @warn "'<#{$element}>' doesn't exist in the reponsive text map";
    }
}



//  4. Get breakpoint for responsive text element
//==============================================================================

@function text-properties-for($element, $breakpoint-name) {

    $element-breakpoints: text-breakpoints-for($element);

    @if map-has-key($element-breakpoints, $breakpoint-name) {
        @return map-get($element-breakpoints, $breakpoint-name);
    } @else {
        @return false;
    }
}




//==============================================================================
//  d. Helpers
//==============================================================================

//  1. Strip Unit
//==============================================================================

/// Strips the units from the passed in value
/// @access private
/// @param {String} $value - Value to be stripped of unit
/// @return {Int}

@function strip-unit($value) {
    @return $value / ($value * 0 + 1);
}



//  2. Remify
//==============================================================================

/// Appends the rem unit to the passed in value
/// @access private
/// @param {Int} $value - Value to append rem unit to
/// @return {String} - returns the value as a rem unit

@function remify($value, $rem-base) {
    $value: strip-unit($value);

    @if ($value == 0) {
        @return 0;
    } @else {
        @return $value / strip-unit($rem-base) * 1rem;
    }
}



//  3. Rem Calc
//==============================================================================

/// Turns a pixel unit into a rem unit by using the base-font-size
/// @access public
/// @param {List|Int|String} $values - Values to remify
/// @param {Int} $rem-base [$base-font-size] - REM base font size
/// @return {Int}

@function rem-calc($values, $rem-base: $base-font-size) {
    $num-vals : length($values);

    @if ($num-vals <= 0) {

        @warn 'You need to supply at least one value to calcRem';

    } @else if ($num-vals == 1) {

        $val: nth($values, 1);
        @return remify($val, $rem-base);

    } @else if ($num-vals > 4) {

        @warn "You\'ve supplied too many values to calcRem";

    } @else {

        $rem-values: ();

        @for $i from 1 through $num-vals {
            $rem-values: append($rem-values, remify(nth($values, $i), $rem-base));
        }

        @return $rem-values;
    }
}
